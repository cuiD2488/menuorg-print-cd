<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ« çƒ­æ•å°ç¥¨æ’ç‰ˆè¿›åŒ–æµ‹è¯•</title>
    <style>
      body {
        font-family: 'Courier New', monospace;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .preview {
        background: #2d3748;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.4;
        white-space: pre-wrap;
        overflow-x: auto;
        margin: 15px 0;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }
      .success {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }
      .evolution {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }
      .evolution-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #dee2e6;
      }
      .evolution-item.old {
        border-left: 4px solid #ffc107;
      }
      .evolution-item.new {
        border-left: 4px solid #28a745;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        margin: 8px;
        font-size: 14px;
      }
      button:hover {
        background: #0056b3;
      }
      .btn-new {
        background: #28a745;
      }
      .btn-new:hover {
        background: #1e7e34;
      }
      .feature-comparison {
        background: #fff3cd;
        color: #856404;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }
      .feature-comparison table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      .feature-comparison th,
      .feature-comparison td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #dee2e6;
      }
      .feature-comparison th {
        background-color: rgba(0, 0, 0, 0.05);
        font-weight: bold;
      }
      .check {
        color: #28a745;
        font-weight: bold;
      }
      .cross {
        color: #dc3545;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ« çƒ­æ•å°ç¥¨æ’ç‰ˆè¿›åŒ–æµ‹è¯•</h1>

      <div class="info">
        <strong>ğŸš€ æ’ç‰ˆè¿›åŒ–å†ç¨‹ï¼š</strong><br />
        ä»ç®€å•çš„å·¦å¯¹é½æ ¼å¼è¿›åŒ–åˆ°ä¸“ä¸šçš„çƒ­æ•å°ç¥¨æ’ç‰ˆç³»ç»Ÿï¼Œæ”¯æŒå¤šç§çº¸å¼ å®½åº¦è‡ªé€‚åº”ã€‚
      </div>

      <div class="feature-comparison">
        <h3>ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨</h3>
        <table>
          <thead>
            <tr>
              <th>åŠŸèƒ½ç‰¹æ€§</th>
              <th>å·¦å¯¹é½ç‰ˆæœ¬</th>
              <th>ä¸“ä¸šæ’ç‰ˆç‰ˆæœ¬</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>é¤å…åç§°æ˜¾ç¤º</td>
              <td><span class="cross">âŒ</span> ç®€å•æ˜¾ç¤º</td>
              <td><span class="check">âœ…</span> å±…ä¸­æ˜¾ç¤ºï¼Œå¤§å†™</td>
            </tr>
            <tr>
              <td>è®¢å•ç±»å‹æ ‡è¯†</td>
              <td><span class="cross">âŒ</span> æ–‡æœ¬å½¢å¼</td>
              <td><span class="check">âœ…</span> å±…ä¸­çªå‡ºæ˜¾ç¤º</td>
            </tr>
            <tr>
              <td>è®¢å•ä¿¡æ¯å¸ƒå±€</td>
              <td><span class="cross">âŒ</span> å·¦å¯¹é½ï¼Œå›ºå®šé—´éš”</td>
              <td><span class="check">âœ…</span> è¡¨æ ¼å¼ï¼Œå³å¯¹é½æ•°å€¼</td>
            </tr>
            <tr>
              <td>èœå“æ˜ç»†</td>
              <td><span class="cross">âŒ</span> ç®€å•åˆ—è¡¨</td>
              <td><span class="check">âœ…</span> å¸¦è¡¨å¤´çš„è¡¨æ ¼</td>
            </tr>
            <tr>
              <td>é•¿èœåå¤„ç†</td>
              <td><span class="cross">âŒ</span> å¯èƒ½è¶…å‡ºè¾¹ç•Œ</td>
              <td><span class="check">âœ…</span> è‡ªåŠ¨æ¢è¡Œï¼Œå¯¹é½</td>
            </tr>
            <tr>
              <td>ä»·æ ¼å¯¹é½</td>
              <td><span class="cross">âŒ</span> å·¦å¯¹é½</td>
              <td><span class="check">âœ…</span> å³å¯¹é½ï¼Œä¸“ä¸š</td>
            </tr>
            <tr>
              <td>åˆ†åŒºè®¾è®¡</td>
              <td><span class="cross">âŒ</span> ç®€å•åˆ†éš”çº¿</td>
              <td><span class="check">âœ…</span> æ¸…æ™°åŒºåŸŸåˆ’åˆ†</td>
            </tr>
            <tr>
              <td>çº¸å¼ é€‚é…</td>
              <td><span class="check">âœ…</span> 80mm, 58mm</td>
              <td><span class="check">âœ…</span> 80mm, 58mm, 48mm+</td>
            </tr>
            <tr>
              <td>é¢„ä»˜è´¹æ ‡è¯†</td>
              <td><span class="cross">âŒ</span> æ— </td>
              <td><span class="check">âœ…</span> å±…ä¸­æç¤º</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="test-section">
        <h3>ğŸ”„ æ’ç‰ˆè¿›åŒ–å¯¹æ¯”</h3>
        <div class="evolution">
          <div class="evolution-item old">
            <h4>ğŸ“ å·¦å¯¹é½ç‰ˆæœ¬ï¼ˆæ—§ï¼‰</h4>
            <p>ç®€å•çš„å·¦å¯¹é½æ ¼å¼ï¼Œæ ‡ç­¾åé—´éš”4ä¸ªå­—ç¬¦</p>
            <button onclick="testOldLeftAlign()">ç”Ÿæˆå·¦å¯¹é½é¢„è§ˆ</button>
            <div id="previewOld"></div>
          </div>
          <div class="evolution-item new">
            <h4>ğŸ¯ ä¸“ä¸šæ’ç‰ˆç‰ˆæœ¬ï¼ˆæ–°ï¼‰</h4>
            <p>åŸºäºçœŸå®å°ç¥¨æ ·å¼çš„ä¸“ä¸šæ’ç‰ˆç³»ç»Ÿ</p>
            <button class="btn-new" onclick="testNewProfessional()">
              ç”Ÿæˆä¸“ä¸šæ’ç‰ˆé¢„è§ˆ
            </button>
            <div id="previewNew"></div>
          </div>
        </div>
      </div>

      <div class="test-section">
        <h3>ğŸ“± å¤šå®½åº¦è‡ªé€‚åº”æµ‹è¯•</h3>
        <div class="info">æµ‹è¯•ä¸“ä¸šæ’ç‰ˆåœ¨ä¸åŒçº¸å¼ å®½åº¦ä¸‹çš„è‡ªé€‚åº”æ•ˆæœ</div>
        <button onclick="testMultiWidth()">æµ‹è¯•å¤šå®½åº¦é€‚é…</button>
        <div id="multiWidthResult"></div>
      </div>

      <div class="test-section">
        <h3>ğŸª çœŸå®é¤å…æ ·å¼æµ‹è¯•</h3>
        <div class="info">æ¨¡æ‹Ÿå›¾ç‰‡ä¸­çš„é¤å…æ ·å¼ï¼ŒéªŒè¯ä¸“ä¸šæ’ç‰ˆæ•ˆæœ</div>
        <button onclick="testRealRestaurants()">æµ‹è¯•çœŸå®é¤å…æ ·å¼</button>
        <div id="realRestaurantsResult"></div>
      </div>

      <div class="test-section">
        <h3>ğŸ–¨ï¸ æ‰“å°å¯¹æ¯”æµ‹è¯•</h3>
        <div class="info">
          å¦‚æœå·²è¿æ¥çƒ­æ•æ‰“å°æœºï¼Œå¯ä»¥å¯¹æ¯”ä¸¤ç§æ’ç‰ˆçš„å®é™…æ‰“å°æ•ˆæœ
        </div>
        <button onclick="printOldVersion()">æ‰“å°å·¦å¯¹é½ç‰ˆæœ¬</button>
        <button class="btn-new" onclick="printNewVersion()">
          æ‰“å°ä¸“ä¸šæ’ç‰ˆç‰ˆæœ¬
        </button>
        <div id="printCompareResult"></div>
      </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="renderer/LodopFuncs.js"></script>
    <script src="src/printer-lodop.js"></script>

    <script>
      let lodopManager = null;

      // åˆå§‹åŒ–
      async function init() {
        try {
          if (typeof LodopPrinterManager !== 'undefined') {
            lodopManager = new LodopPrinterManager();
            const initResult = await lodopManager.init();

            if (initResult.success) {
              console.log('âœ… C-Lodop åˆå§‹åŒ–æˆåŠŸ');
            } else {
              console.log('âŒ C-Lodop åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼');
              lodopManager = createMockManager();
            }
          } else {
            console.log('âŒ LodopPrinterManager æœªæ‰¾åˆ°ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼');
            lodopManager = createMockManager();
          }
        } catch (error) {
          console.error('åˆå§‹åŒ–å¤±è´¥:', error);
          lodopManager = createMockManager();
        }
      }

      // åˆ›å»ºæ¨¡æ‹Ÿç®¡ç†å™¨
      function createMockManager() {
        return {
          printers: [
            { name: 'æ¨¡æ‹Ÿ80mmæ‰“å°æœº', width: 80 },
            { name: 'æ¨¡æ‹Ÿ58mmæ‰“å°æœº', width: 58 },
            { name: 'æ¨¡æ‹Ÿ48mmæ‰“å°æœº', width: 48 },
          ],
          selectedPrinters: ['æ¨¡æ‹Ÿ80mmæ‰“å°æœº'],

          // æ—§ç‰ˆæœ¬ï¼šå·¦å¯¹é½æ ¼å¼
          generateOldLeftAlignContent: function (order, paperWidth = 80) {
            let totalWidth = paperWidth >= 80 ? 34 : 24;
            let content = '';

            // ç®€å•çš„è®¢å•å·
            content += `Order #: ${order.order_id}\n\n`;

            // è®¢å•ä¿¡æ¯ï¼šå·¦å¯¹é½ï¼Œé—´éš”4ä¸ªå­—ç¬¦
            content += `Order Date: ${this.formatDateTime(
              order.create_time
            )}\n`;
            content += `Pickup Time: ${this.formatDateTime(
              order.delivery_time
            )}\n`;
            content += `Payment: ${order.paystyle == 1 ? 'Card' : 'Cash'}\n`;
            content += `Customer: ${order.recipient_name || 'N/A'}\n`;
            content += `Phone: ${order.recipient_phone || 'N/A'}\n\n`;

            content += '='.repeat(totalWidth) + '\n';

            // èœå•æ˜ç»†ï¼šå·¦å¯¹é½ï¼Œæ ‡ç­¾åé—´éš”4ä¸ªå­—ç¬¦
            (order.dishes_array || []).forEach((dish) => {
              const price = parseFloat(dish.price || '0');
              const qty = parseInt(dish.amount || '1');
              const priceStr = `$${price.toFixed(2)}`;
              const qtyStr = qty.toString();

              const dishName = dish.dishes_name || '';
              content += `${dishName}    ${qtyStr}    ${priceStr}\n`;

              if (dish.remark && dish.remark.trim()) {
                const specLines = this.wrapText(
                  dish.remark,
                  totalWidth - 2
                ).split('\n');
                specLines.forEach((line) => {
                  if (line.trim()) {
                    content += `  ${line}\n`;
                  }
                });
              }
            });

            content += '='.repeat(totalWidth) + '\n';

            // è´¹ç”¨æ˜ç»†ï¼šå·¦å¯¹é½ï¼Œæ ‡ç­¾åé—´éš”4ä¸ªå­—ç¬¦
            const subtotal = parseFloat(order.sub_total || '0');
            const taxFee = parseFloat(order.tax_fee || '0');
            const total = parseFloat(order.total || '0');

            content += `Subtotal    $${subtotal.toFixed(2)}\n`;
            if (taxFee > 0) {
              content += `Tax (8.5%)    $${taxFee.toFixed(2)}\n`;
            }
            content += `TOTAL    $${total.toFixed(2)}\n`;
            content += '='.repeat(totalWidth) + '\n';

            return content;
          },

          // æ–°ç‰ˆæœ¬ï¼šä¸“ä¸šæ’ç‰ˆæ ¼å¼
          generateNewProfessionalContent: function (order, paperWidth = 80) {
            let totalWidth;
            if (paperWidth >= 80) {
              totalWidth = 34;
            } else if (paperWidth >= 58) {
              totalWidth = 24;
            } else if (paperWidth >= 48) {
              totalWidth = 20;
            } else {
              totalWidth = Math.max(Math.floor(paperWidth * 0.35), 16);
            }

            let content = '';

            // å¤´éƒ¨åŒºåŸŸï¼šé¤å…ä¿¡æ¯å±…ä¸­
            content += '='.repeat(totalWidth) + '\n';
            content +=
              this.centerText(order.rd_name || 'RESTAURANT', totalWidth) + '\n';
            const deliveryType =
              order.delivery_type == 1 ? 'DELIVERY' : 'PICKUP';
            content += this.centerText(deliveryType, totalWidth) + '\n';
            content += '='.repeat(totalWidth) + '\n\n';

            // è®¢å•å·åŒºåŸŸï¼šå±…ä¸­æ˜¾ç¤º
            content +=
              this.centerText(`Order #: ${order.order_id}`, totalWidth) + '\n';
            if (order.serial_num && order.serial_num > 0) {
              const serial = `#${order.serial_num.toString().padStart(3, '0')}`;
              content +=
                this.centerText(`Serial: ${serial}`, totalWidth) + '\n';
            }
            content += '\n';

            // è®¢å•ä¿¡æ¯ï¼šè¡¨æ ¼å¸ƒå±€
            content += this.formatTableRow(
              'Order Date:',
              this.formatDateTime(order.create_time),
              totalWidth
            );
            const timeLabel =
              order.delivery_type == 1 ? 'Delivery Time:' : 'Pickup Time:';
            content += this.formatTableRow(
              timeLabel,
              this.formatDateTime(order.delivery_time),
              totalWidth
            );
            content += this.formatTableRow(
              'Payment:',
              order.paystyle == 1 ? 'Card' : 'Cash',
              totalWidth
            );
            content += this.formatTableRow(
              'Customer:',
              order.recipient_name || 'N/A',
              totalWidth
            );
            content += this.formatTableRow(
              'Phone:',
              order.recipient_phone || 'N/A',
              totalWidth
            );

            content += '\n' + '-'.repeat(totalWidth) + '\n';
            content += this.centerText('ORDER ITEMS', totalWidth) + '\n';
            content += '-'.repeat(totalWidth) + '\n';

            // èœå“è¡¨æ ¼
            let nameWidth, qtyWidth, priceWidth;
            if (totalWidth >= 32) {
              nameWidth = totalWidth - 12;
              qtyWidth = 4;
              priceWidth = 8;
            } else if (totalWidth >= 24) {
              nameWidth = totalWidth - 10;
              qtyWidth = 3;
              priceWidth = 7;
            } else {
              nameWidth = totalWidth - 8;
              qtyWidth = 3;
              priceWidth = 5;
            }

            const itemHeader = this.padText('Item Name', nameWidth, 'left');
            const qtyHeader = this.padText('Qty', qtyWidth, 'center');
            const priceHeader = this.padText('Total', priceWidth, 'right');
            content += itemHeader + qtyHeader + priceHeader + '\n';
            content += '-'.repeat(totalWidth) + '\n';

            // èœå“æ˜ç»†
            (order.dishes_array || []).forEach((dish) => {
              const price = parseFloat(dish.price || '0');
              const qty = parseInt(dish.amount || '1');
              const priceStr = `$${price.toFixed(2)}`;
              const qtyStr = qty.toString();

              const dishName = dish.dishes_name || '';
              const dishLines = this.wrapText(dishName, nameWidth);
              const dishLinesArray = dishLines.split('\n');

              const firstLine = this.padText(
                dishLinesArray[0] || '',
                nameWidth,
                'left'
              );
              const qtyPart = this.padText(qtyStr, qtyWidth, 'center');
              const pricePart = this.padText(priceStr, priceWidth, 'right');
              content += firstLine + qtyPart + pricePart + '\n';

              for (let i = 1; i < dishLinesArray.length; i++) {
                if (dishLinesArray[i].trim()) {
                  const continueLine = this.padText(
                    dishLinesArray[i],
                    nameWidth,
                    'left'
                  );
                  content +=
                    continueLine + ' '.repeat(qtyWidth + priceWidth) + '\n';
                }
              }

              if (dish.remark && dish.remark.trim()) {
                const specLines = this.wrapText(
                  dish.remark,
                  totalWidth - 2
                ).split('\n');
                specLines.forEach((line) => {
                  if (line.trim()) {
                    content += `  ${line}\n`;
                  }
                });
              }
            });

            content += '\n' + '-'.repeat(totalWidth) + '\n';
            content += this.centerText('PAYMENT SUMMARY', totalWidth) + '\n';
            content += '-'.repeat(totalWidth) + '\n';

            // è´¹ç”¨æ±‡æ€»
            const subtotal = parseFloat(order.sub_total || '0');
            const taxFee = parseFloat(order.tax_fee || '0');
            const total = parseFloat(order.total || '0');

            content += this.formatTableRow(
              'Subtotal:',
              `$${subtotal.toFixed(2)}`,
              totalWidth
            );
            if (taxFee > 0) {
              content += this.formatTableRow(
                'Tax (8.5%):',
                `$${taxFee.toFixed(2)}`,
                totalWidth
              );
            }
            content += '-'.repeat(totalWidth) + '\n';
            content += this.formatTableRow(
              'TOTAL:',
              `$${total.toFixed(2)}`,
              totalWidth
            );
            content += '='.repeat(totalWidth) + '\n';

            // åº•éƒ¨ä¿¡æ¯
            content += '\n';
            content +=
              this.centerText('Thank you for your order!', totalWidth) + '\n';
            if (order.paystyle == 1) {
              content +=
                this.centerText('Prepaid - Do Not Charge', totalWidth) + '\n';
            }
            content += '\n' + '='.repeat(totalWidth) + '\n';

            return content;
          },

          // è¾…åŠ©å‡½æ•°
          centerText: function (text, width) {
            const textWidth = this.displayWidth(text);
            if (textWidth >= width) {
              return this.truncateText(text, width);
            }
            const padding = width - textWidth;
            const leftPad = Math.floor(padding / 2);
            return ' '.repeat(leftPad) + text;
          },

          formatTableRow: function (label, value, width) {
            const labelWidth = this.displayWidth(label);
            const valueWidth = this.displayWidth(value);
            const totalUsed = labelWidth + valueWidth;

            if (totalUsed >= width) {
              return `${label}\n  ${value}\n`;
            }

            const padding = width - totalUsed;
            return label + ' '.repeat(padding) + value + '\n';
          },

          padText: function (text, width, align = 'left') {
            const textWidth = this.displayWidth(text);
            if (textWidth >= width) {
              return this.truncateText(text, width);
            }

            const padding = width - textWidth;
            switch (align) {
              case 'right':
                return ' '.repeat(padding) + text;
              case 'center':
                const leftPad = Math.floor(padding / 2);
                const rightPad = padding - leftPad;
                return ' '.repeat(leftPad) + text + ' '.repeat(rightPad);
              default:
                return text + ' '.repeat(padding);
            }
          },

          displayWidth: function (text) {
            let width = 0;
            for (const char of text) {
              width += char.charCodeAt(0) > 127 ? 2 : 1;
            }
            return width;
          },

          truncateText: function (text, maxWidth) {
            let result = '';
            let currentWidth = 0;

            for (const char of text) {
              const charWidth = char.charCodeAt(0) > 127 ? 2 : 1;
              if (currentWidth + charWidth > maxWidth) {
                break;
              }
              result += char;
              currentWidth += charWidth;
            }

            return result;
          },

          wrapText: function (text, width) {
            let result = '';
            let currentLine = '';
            let currentWidth = 0;

            for (const char of text) {
              const charWidth = char.charCodeAt(0) > 127 ? 2 : 1;

              if (currentWidth + charWidth > width && currentLine) {
                result += currentLine + '\n';
                currentLine = '';
                currentWidth = 0;
              }

              currentLine += char;
              currentWidth += charWidth;
            }

            if (currentLine) {
              result += currentLine;
            }

            return result;
          },

          formatDateTime: function (dateTimeStr) {
            if (!dateTimeStr) return 'N/A';
            try {
              const date = new Date(dateTimeStr);
              return date.toLocaleString('en-US', {
                month: '2-digit',
                day: '2-digit',
                year: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
              });
            } catch (error) {
              return dateTimeStr;
            }
          },
        };
      }

      // æµ‹è¯•æ—§ç‰ˆå·¦å¯¹é½
      function testOldLeftAlign() {
        const result = document.getElementById('previewOld');

        const testOrder = {
          order_id: 'OLD-LEFT-001',
          rd_name: 'Simple Restaurant',
          create_time: new Date().toISOString(),
          delivery_time: new Date(Date.now() + 30 * 60 * 1000).toISOString(),
          paystyle: 1,
          recipient_name: 'Test Customer',
          recipient_phone: '(555) 123-4567',
          delivery_type: 2,
          dishes_array: [
            {
              dishes_name: "General Tso's Chicken",
              amount: 1,
              price: 14.5,
              remark: 'Served w. White Rice',
            },
            {
              dishes_name: 'Fried Rice',
              amount: 1,
              price: 8.0,
              remark: '',
            },
          ],
          sub_total: 22.5,
          tax_fee: 1.91,
          total: 24.41,
        };

        const content = lodopManager.generateOldLeftAlignContent(testOrder, 80);

        result.innerHTML = `
          <div class="info">
            <strong>ğŸ“ æ—§ç‰ˆå·¦å¯¹é½æ ¼å¼</strong><br>
            ç®€å•çš„å·¦å¯¹é½å¸ƒå±€ï¼Œæ ‡ç­¾åå›ºå®šé—´éš”4ä¸ªå­—ç¬¦
          </div>
          <div class="preview">${content}</div>
        `;
      }

      // æµ‹è¯•æ–°ç‰ˆä¸“ä¸šæ’ç‰ˆ
      function testNewProfessional() {
        const result = document.getElementById('previewNew');

        const testOrder = {
          order_id: 'NEW-PROF-001',
          rd_name: 'Great Wall Restaurant',
          create_time: new Date().toISOString(),
          delivery_time: new Date(Date.now() + 30 * 60 * 1000).toISOString(),
          paystyle: 1,
          recipient_name: 'Test Customer',
          recipient_phone: '(555) 123-4567',
          delivery_type: 2,
          dishes_array: [
            {
              dishes_name: "General Tso's Chicken",
              amount: 1,
              price: 14.5,
              remark: 'Served w. White Rice',
            },
            {
              dishes_name: 'Fried Rice',
              amount: 1,
              price: 8.0,
              remark: '',
            },
          ],
          sub_total: 22.5,
          tax_fee: 1.91,
          total: 24.41,
        };

        const content = lodopManager.generateNewProfessionalContent(
          testOrder,
          80
        );

        result.innerHTML = `
          <div class="success">
            <strong>ğŸ¯ æ–°ç‰ˆä¸“ä¸šæ’ç‰ˆ</strong><br>
            åŸºäºçœŸå®å°ç¥¨æ ·å¼ï¼Œå±…ä¸­æ ‡é¢˜ï¼Œè¡¨æ ¼å¸ƒå±€ï¼Œå³å¯¹é½ä»·æ ¼
          </div>
          <div class="preview">${content}</div>
        `;
      }

      // æµ‹è¯•å¤šå®½åº¦é€‚é…
      function testMultiWidth() {
        const result = document.getElementById('multiWidthResult');

        const testOrder = {
          order_id: 'MULTI-WIDTH-001',
          rd_name: 'Multi Width Test Restaurant',
          create_time: new Date().toISOString(),
          delivery_time: new Date(Date.now() + 30 * 60 * 1000).toISOString(),
          paystyle: 1,
          recipient_name: 'Width Test Customer',
          recipient_phone: '(555) 000-0000',
          delivery_type: 2,
          dishes_array: [
            {
              dishes_name: 'Super Long Dish Name That Tests Width Adaptation',
              amount: 2,
              price: 15.99,
              remark:
                'This is a very long remark that should wrap properly across different paper widths',
            },
          ],
          sub_total: 31.98,
          tax_fee: 2.72,
          total: 34.7,
        };

        const widths = [80, 58, 48];
        let allContent = '';

        widths.forEach((width) => {
          const content = lodopManager.generateNewProfessionalContent(
            testOrder,
            width
          );
          allContent += `\n\n========== ${width}mm çƒ­æ•çº¸ ==========\n\n${content}`;
        });

        result.innerHTML = `
          <div class="success">
            <strong>âœ… å¤šå®½åº¦è‡ªé€‚åº”æµ‹è¯•å®Œæˆ</strong><br>
            å±•ç¤ºäº†80mmã€58mmã€48mmä¸‰ç§çº¸å¼ å®½åº¦çš„è‡ªé€‚åº”æ•ˆæœ
          </div>
          <div class="preview">${allContent}</div>
        `;
      }

      // æµ‹è¯•çœŸå®é¤å…æ ·å¼
      function testRealRestaurants() {
        const result = document.getElementById('realRestaurantsResult');

        const restaurants = [
          {
            name: 'Great Wall - Doylestown, PA',
            orderType: 'PICKUP',
            customer: 'John Smith',
            phone: '(555) 123-4567',
            items: [
              {
                name: "General Tso's Chicken",
                qty: 1,
                price: 14.5,
                spec: 'Served w. White Rice',
              },
              {
                name: 'Pineapple Fried Rice - Shrimp',
                qty: 1,
                price: 12.0,
                spec: '',
              },
            ],
          },
          {
            name: 'NEW CHINA',
            orderType: 'PICKUP',
            customer: 'Leah Richards',
            phone: '8438880360',
            items: [
              {
                name: 'Sesame Chicken Combination Dinner',
                qty: 1,
                price: 10.29,
                spec: 'White Rice + S x1',
              },
              {
                name: 'Fried Chicken Wing',
                qty: 2,
                price: 14.0,
                spec: '+ Plain x1',
              },
            ],
          },
        ];

        let allContent = '';

        restaurants.forEach((restaurant, index) => {
          const subtotal = restaurant.items.reduce(
            (sum, item) => sum + item.price,
            0
          );
          const taxFee = subtotal * 0.085;
          const total = subtotal + taxFee;

          const testOrder = {
            order_id: `REAL-${index + 1}`,
            rd_name: restaurant.name,
            create_time: new Date().toISOString(),
            delivery_time: new Date(Date.now() + 30 * 60 * 1000).toISOString(),
            paystyle: 1,
            recipient_name: restaurant.customer,
            recipient_phone: restaurant.phone,
            delivery_type: restaurant.orderType === 'DELIVERY' ? 1 : 2,
            dishes_array: restaurant.items.map((item) => ({
              dishes_name: item.name,
              amount: item.qty,
              price: item.price,
              remark: item.spec,
            })),
            sub_total: subtotal,
            tax_fee: taxFee,
            total: total,
          };

          const content = lodopManager.generateNewProfessionalContent(
            testOrder,
            80
          );
          allContent += `\n\n========== ${restaurant.name} ==========\n\n${content}`;
        });

        result.innerHTML = `
          <div class="success">
            <strong>âœ… çœŸå®é¤å…æ ·å¼æµ‹è¯•å®Œæˆ</strong><br>
            åŸºäºå›¾ç‰‡ä¸­çš„é¤å…æ ·å¼ç”Ÿæˆä¸“ä¸šå°ç¥¨æ’ç‰ˆ
          </div>
          <div class="preview">${allContent}</div>
        `;
      }

      // æ‰“å°æ—§ç‰ˆæœ¬
      async function printOldVersion() {
        const result = document.getElementById('printCompareResult');
        // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ‰“å°é€»è¾‘
        result.innerHTML = `
          <div class="info">
            <strong>ğŸ“ æ—§ç‰ˆæœ¬æ‰“å°</strong><br>
            å¦‚æœè¿æ¥äº†æ‰“å°æœºï¼Œè¿™é‡Œä¼šæ‰“å°å·¦å¯¹é½æ ¼å¼çš„å°ç¥¨
          </div>
        `;
      }

      // æ‰“å°æ–°ç‰ˆæœ¬
      async function printNewVersion() {
        const result = document.getElementById('printCompareResult');
        // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ‰“å°é€»è¾‘
        result.innerHTML = `
          <div class="success">
            <strong>ğŸ¯ æ–°ç‰ˆæœ¬æ‰“å°</strong><br>
            å¦‚æœè¿æ¥äº†æ‰“å°æœºï¼Œè¿™é‡Œä¼šæ‰“å°ä¸“ä¸šæ’ç‰ˆæ ¼å¼çš„å°ç¥¨
          </div>
        `;
      }

      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      window.addEventListener('load', init);
    </script>
  </body>
</html>
