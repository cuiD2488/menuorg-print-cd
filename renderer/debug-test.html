<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è°ƒè¯•ç³»ç»Ÿæµ‹è¯•é¡µé¢</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .test-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
      }
      .test-button:hover {
        background: #0056b3;
      }
      .test-button.danger {
        background: #dc3545;
      }
      .test-button.danger:hover {
        background: #c82333;
      }
      .test-button.success {
        background: #28a745;
      }
      .test-button.success:hover {
        background: #218838;
      }
      .test-output {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        font-family: monospace;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>ğŸ” è°ƒè¯•ç³»ç»Ÿæµ‹è¯•é¡µé¢</h1>
      <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•ç”Ÿäº§ç¯å¢ƒè°ƒè¯•ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½ã€‚</p>

      <div class="test-section">
        <h3>åŸºç¡€æ—¥å¿—æµ‹è¯•</h3>
        <button class="test-button" onclick="testBasicLogs()">
          æµ‹è¯•åŸºç¡€æ—¥å¿—
        </button>
        <button class="test-button danger" onclick="testErrorLogs()">
          æµ‹è¯•é”™è¯¯æ—¥å¿—
        </button>
        <button class="test-button success" onclick="testSuccessLogs()">
          æµ‹è¯•æˆåŠŸæ—¥å¿—
        </button>
      </div>

      <div class="test-section">
        <h3>æ‰“å°åŠŸèƒ½æµ‹è¯•</h3>
        <button class="test-button" onclick="testPrintOperation()">
          æ¨¡æ‹Ÿæ‰“å°æ“ä½œ
        </button>
        <button class="test-button danger" onclick="testPrintError()">
          æ¨¡æ‹Ÿæ‰“å°é”™è¯¯
        </button>
        <button class="test-button" onclick="testBatchPrint()">
          æ¨¡æ‹Ÿæ‰¹é‡æ‰“å°
        </button>
      </div>

      <div class="test-section">
        <h3>ç½‘ç»œåŠŸèƒ½æµ‹è¯•</h3>
        <button class="test-button" onclick="testApiCall()">æ¨¡æ‹ŸAPIè°ƒç”¨</button>
        <button class="test-button danger" onclick="testApiError()">
          æ¨¡æ‹ŸAPIé”™è¯¯
        </button>
        <button class="test-button" onclick="testWebSocketConnection()">
          æµ‹è¯•WebSocketè¿æ¥
        </button>
      </div>

      <div class="test-section">
        <h3>æ€§èƒ½æµ‹è¯•</h3>
        <button class="test-button" onclick="testPerformanceMetrics()">
          æ”¶é›†æ€§èƒ½æŒ‡æ ‡
        </button>
        <button class="test-button" onclick="testMemoryUsage()">
          æ¨¡æ‹Ÿå†…å­˜ä½¿ç”¨
        </button>
      </div>

      <div class="test-section">
        <h3>ç³»ç»Ÿè¯Šæ–­</h3>
        <button class="test-button success" onclick="runQuickDiagnosis()">
          è¿è¡Œå¿«é€Ÿè¯Šæ–­
        </button>
        <button class="test-button" onclick="exportTestLogs()">
          å¯¼å‡ºæµ‹è¯•æ—¥å¿—
        </button>
        <button class="test-button danger" onclick="clearAllLogs()">
          æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
        </button>
      </div>

      <div class="test-output" id="testOutput">æµ‹è¯•è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="js/printer.js"></script>
    <script src="js/app.js"></script>

    <script>
      // åˆå§‹åŒ–æµ‹è¯•åº”ç”¨
      let testApp;

      document.addEventListener('DOMContentLoaded', async () => {
        try {
          // åˆ›å»ºæµ‹è¯•åº”ç”¨å®ä¾‹
          testApp = new OrderPrintApp();

          // æ¨¡æ‹Ÿä¸€äº›åŸºç¡€æ•°æ®
          testApp.currentUser = { user_id: 'test_user', username: 'test' };
          testApp.selectedOrder = {
            order_id: 'TEST_001',
            recipient_name: 'æµ‹è¯•ç”¨æˆ·',
            total_amount: 88.88,
            dishes_array: [
              { dishes_name: 'æµ‹è¯•èœå“1', quantity: 2 },
              { dishes_name: 'æµ‹è¯•èœå“2', quantity: 1 },
            ],
          };

          // åˆå§‹åŒ–è°ƒè¯•ç³»ç»Ÿ
          await testApp.init();

          log('âœ… è°ƒè¯•ç³»ç»Ÿæµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ');
        } catch (error) {
          log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
        }
      });

      function log(message) {
        const output = document.getElementById('testOutput');
        const timestamp = new Date().toLocaleTimeString();
        output.textContent += `[${timestamp}] ${message}\n`;
        output.scrollTop = output.scrollHeight;
      }

      // æµ‹è¯•åŸºç¡€æ—¥å¿—
      function testBasicLogs() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.debugLog('è¿™æ˜¯ä¸€æ¡ä¿¡æ¯æ—¥å¿—', 'info');
        testApp.debugLog('è¿™æ˜¯ä¸€æ¡è­¦å‘Šæ—¥å¿—', 'warn');
        testApp.debugLog('è¿™æ˜¯ä¸€æ¡è°ƒè¯•æ—¥å¿—', 'info');
        log('âœ… åŸºç¡€æ—¥å¿—æµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•é”™è¯¯æ—¥å¿—
      function testErrorLogs() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.debugLog('æ¨¡æ‹Ÿç½‘ç»œè¿æ¥é”™è¯¯', 'error', 'network');
        testApp.debugLog('æ¨¡æ‹Ÿæ‰“å°æœºç¦»çº¿é”™è¯¯', 'error', 'print');
        testApp.debugLog('æ¨¡æ‹Ÿç³»ç»Ÿå¼‚å¸¸é”™è¯¯', 'error');
        log('âœ… é”™è¯¯æ—¥å¿—æµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•æˆåŠŸæ—¥å¿—
      function testSuccessLogs() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.debugLog('æ‰“å°ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ', 'success', 'print');
        testApp.debugLog('ç½‘ç»œè¿æ¥å»ºç«‹æˆåŠŸ', 'success', 'network');
        testApp.debugLog('ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ', 'success');
        log('âœ… æˆåŠŸæ—¥å¿—æµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•æ‰“å°æ“ä½œ
      function testPrintOperation() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.recordPrintOperation('æµ‹è¯•æ‰“å°æœº1', 'TEST_001', 1500, true);
        testApp.recordPrintOperation('æµ‹è¯•æ‰“å°æœº2', 'TEST_001', 2300, true);
        log('âœ… æ‰“å°æ“ä½œæµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•æ‰“å°é”™è¯¯
      function testPrintError() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.recordPrintOperation(
          'æ•…éšœæ‰“å°æœº',
          'TEST_002',
          5000,
          false,
          'æ‰“å°æœºç¦»çº¿'
        );
        testApp.debugLog('æ‰“å°æœºé€šä¿¡è¶…æ—¶', 'error', 'print');
        log('âœ… æ‰“å°é”™è¯¯æµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•æ‰¹é‡æ‰“å°
      function testBatchPrint() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        const printers = ['æ‰“å°æœºA', 'æ‰“å°æœºB', 'æ‰“å°æœºC'];
        printers.forEach((printer, index) => {
          const success = Math.random() > 0.3; // 70%æˆåŠŸç‡
          const duration = 1000 + Math.random() * 2000;
          const error = success ? null : 'éšæœºæ¨¡æ‹Ÿé”™è¯¯';
          testApp.recordPrintOperation(
            printer,
            `BATCH_${index + 1}`,
            duration,
            success,
            error
          );
        });
        log('âœ… æ‰¹é‡æ‰“å°æµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•APIè°ƒç”¨
      function testApiCall() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.recordApiCall('è·å–è®¢å•åˆ—è¡¨', 800, true);
        testApp.recordApiCall('ç”¨æˆ·ç™»å½•', 1200, true);
        testApp.recordApiCall('ä¸Šä¼ æ‰“å°æ—¥å¿—', 2500, true);
        log('âœ… APIè°ƒç”¨æµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•APIé”™è¯¯
      function testApiError() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.recordApiCall('è·å–è®¢å•è¯¦æƒ…', 5000, false, 'ç½‘ç»œè¶…æ—¶');
        testApp.recordApiCall('æ‰“å°æœºçŠ¶æ€æŸ¥è¯¢', 3000, false, 'æœåŠ¡å™¨é”™è¯¯500');
        log('âœ… APIé”™è¯¯æµ‹è¯•å®Œæˆ');
      }

      // æµ‹è¯•WebSocketè¿æ¥
      function testWebSocketConnection() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.debugLog('å°è¯•å»ºç«‹WebSocketè¿æ¥', 'info', 'network');
        setTimeout(() => {
          testApp.debugLog('WebSocketè¿æ¥å»ºç«‹æˆåŠŸ', 'success', 'network');
          testApp.recordApiCall('WebSocket-Connect', 1500, true);
        }, 1000);
        log('âœ… WebSocketè¿æ¥æµ‹è¯•å¼€å§‹');
      }

      // æµ‹è¯•æ€§èƒ½æŒ‡æ ‡
      function testPerformanceMetrics() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.collectPerformanceMetrics();
        log('âœ… æ€§èƒ½æŒ‡æ ‡æ”¶é›†å®Œæˆ');
      }

      // æµ‹è¯•å†…å­˜ä½¿ç”¨
      function testMemoryUsage() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        // æ¨¡æ‹Ÿä¸€äº›å†…å­˜ä½¿ç”¨
        const testData = new Array(10000).fill('test data');
        testApp.debugLog(
          `æ¨¡æ‹Ÿå†…å­˜ä½¿ç”¨: ${testData.length} æ¡æ•°æ®`,
          'info',
          'performance'
        );

        // æ¸…ç†
        setTimeout(() => {
          testData.length = 0;
          testApp.debugLog('å†…å­˜æ•°æ®å·²æ¸…ç†', 'info', 'performance');
        }, 2000);

        log('âœ… å†…å­˜ä½¿ç”¨æµ‹è¯•å®Œæˆ');
      }

      // è¿è¡Œå¿«é€Ÿè¯Šæ–­
      async function runQuickDiagnosis() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        try {
          log('ğŸ” å¼€å§‹è¿è¡Œå¿«é€Ÿè¯Šæ–­...');
          const result = await testApp.performQuickDiagnosis();
          log(`âœ… å¿«é€Ÿè¯Šæ–­å®Œæˆï¼Œæ€»ä½“çŠ¶æ€: ${result.overallStatus}`);
        } catch (error) {
          log(`âŒ å¿«é€Ÿè¯Šæ–­å¤±è´¥: ${error.message}`);
        }
      }

      // å¯¼å‡ºæµ‹è¯•æ—¥å¿—
      function exportTestLogs() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.exportDebugLogs();
        log('âœ… æµ‹è¯•æ—¥å¿—å¯¼å‡ºå®Œæˆ');
      }

      // æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
      function clearAllLogs() {
        if (!testApp) return log('âŒ åº”ç”¨æœªåˆå§‹åŒ–');

        testApp.clearDebugLogs();
        log('âœ… æ‰€æœ‰æ—¥å¿—å·²æ¸…ç©º');
      }
    </script>
  </body>
</html>
