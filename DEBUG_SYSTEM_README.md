# 🔍 生产环境调试系统使用指南

## 概述

本调试系统专为解决生产环境中打印功能异常的问题而设计。当用户在某些电脑上点击打印没有效果时，可以通过这个调试系统快速定位和解决问题。

## 功能特性

### 📋 多标签页调试面板
- **通用日志**: 记录所有系统操作和错误信息
- **打印错误**: 专门记录打印相关的错误和问题
- **系统信息**: 显示当前系统环境和配置信息
- **网络状态**: 监控网络连接和API调用状态
- **性能监控**: 追踪系统性能指标和打印操作耗时
- **使用说明**: 详细的使用指南和问题排查步骤

### 🔧 核心功能
- **实时日志记录**: 自动记录所有打印操作、网络请求、系统事件
- **错误追踪**: 详细记录错误堆栈、上下文信息
- **性能监控**: 监控打印耗时、内存使用、API响应时间
- **快速诊断**: 一键检查系统状态，生成诊断报告
- **日志导出**: 支持导出完整的调试数据为JSON文件
- **自动恢复**: 检测到问题时尝试自动修复

## 使用方法

### 1. 启用调试模式

在生产环境中，调试系统会自动初始化。用户可以通过以下方式启用调试面板：

```javascript
// 方法1：通过控制台启用
window.app.debugMode = true;
window.app.toggleDebugPanel();

// 方法2：通过localStorage启用
localStorage.setItem('debugMode', 'true');
location.reload();
```

### 2. 查看调试信息

启用调试模式后，页面右下角会出现调试面板，包含：
- 实时日志显示
- 系统状态信息
- 性能指标
- 错误追踪

### 3. 诊断打印问题

当打印功能异常时：

1. **查看打印错误标签页**
   - 检查是否有打印相关的错误信息
   - 查看打印机状态和选择情况

2. **运行快速诊断**
   - 点击"快速诊断"按钮
   - 系统会自动检查打印机状态、网络连接等

3. **检查系统信息**
   - 确认Electron API是否可用
   - 检查浏览器和系统环境

4. **查看性能监控**
   - 检查打印操作的耗时
   - 查看是否有性能瓶颈

### 4. 导出调试数据

遇到无法解决的问题时：

1. 点击"导出日志"按钮
2. 系统会生成包含完整调试信息的JSON文件
3. 将文件发送给技术支持进行分析

## 技术实现

### 调试日志系统

```javascript
// 统一的日志记录接口
debugLog(message, level = 'info', category = 'general')

// 示例用法
app.debugLog('打印任务开始', 'info', 'print');
app.debugLog('网络连接失败', 'error', 'network');
app.debugLog('操作成功完成', 'success');
```

### 性能监控

```javascript
// 记录打印操作性能
recordPrintOperation(printerName, orderId, duration, success, error)

// 记录API调用性能
recordApiCall(apiName, duration, success, error)

// 收集系统性能指标
collectPerformanceMetrics()
```

### 错误追踪

系统会自动捕获和记录：
- JavaScript错误和异常
- 网络请求失败
- 打印操作失败
- WebSocket连接问题

## 常见问题排查

### 问题1：点击打印没有反应

**排查步骤：**
1. 检查调试面板中的"打印错误"标签页
2. 确认是否选择了打印机
3. 查看系统信息中的Electron API状态
4. 运行快速诊断检查打印机状态

**常见原因：**
- 打印机未选择或离线
- Electron API不可用
- 订单数据异常
- 网络连接问题

### 问题2：打印速度慢

**排查步骤：**
1. 查看性能监控中的打印耗时
2. 检查网络状态和API响应时间
3. 查看内存使用情况

**优化建议：**
- 检查网络连接质量
- 减少并发打印数量
- 清理系统缓存

### 问题3：部分打印机失败

**排查步骤：**
1. 查看打印错误中的详细失败信息
2. 检查特定打印机的状态
3. 查看网络连接稳定性

## 测试验证

系统提供了专门的测试页面 `renderer/debug-test.html`，可以用来验证调试系统的各项功能：

1. 基础日志测试
2. 打印功能测试
3. 网络功能测试
4. 性能测试
5. 系统诊断测试

## 注意事项

1. **性能影响**: 调试系统会占用一定的系统资源，建议在解决问题后关闭
2. **数据隐私**: 调试日志可能包含敏感信息，请谨慎分享
3. **存储空间**: 长时间运行会积累大量日志，建议定期清理
4. **兼容性**: 部分功能需要Electron环境支持

## 更新日志

- **v1.0.0**: 初始版本，包含基础调试功能
- **v1.1.0**: 添加性能监控和网络状态追踪
- **v1.2.0**: 增加快速诊断和自动恢复功能
- **v1.3.0**: 完善用户界面和使用说明

## 技术支持

如果您在使用过程中遇到问题，请：

1. 首先查看调试面板中的错误信息
2. 运行快速诊断获取系统状态
3. 导出调试日志文件
4. 联系技术支持并提供日志文件

---

*本调试系统旨在提高生产环境问题诊断效率，帮助快速定位和解决打印相关问题。*