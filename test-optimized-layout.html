<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ« çƒ­æ•å°ç¥¨æ’ç‰ˆæµ‹è¯•</title>
    <style>
      body {
        font-family: 'Courier New', monospace;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .preview {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 5px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.4;
        white-space: pre-wrap;
        overflow-x: auto;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .width-info {
        background: #fff3cd;
        color: #856404;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ« çƒ­æ•å°ç¥¨æ’ç‰ˆæµ‹è¯•</h1>

      <div class="test-section">
        <h3>ğŸ“Š çƒ­æ•å°ç¥¨å­—ç¬¦å®½åº¦è®¾ç½®</h3>
        <div class="width-info">
          <strong>80mmçƒ­æ•çº¸:</strong> 32å­—ç¬¦å®½åº¦ï¼Œå­—ä½“12pt<br />
          <strong>58mmçƒ­æ•çº¸:</strong> 24å­—ç¬¦å®½åº¦ï¼Œå­—ä½“11pt<br />
          <strong>ç‰¹ç‚¹:</strong>
          è®¢å•ä¿¡æ¯é å·¦å¯¹é½ï¼Œèœå•è¡¨æ ¼å›ºå®šåˆ—å®½ï¼Œä»·æ ¼é å³å¯¹é½
        </div>
        <button onclick="testThermalWidths()">æµ‹è¯•çƒ­æ•çº¸å®½åº¦</button>
        <div id="thermalWidthResult"></div>
      </div>

      <div class="test-section">
        <h3>ğŸ“‹ è®¢å•ä¿¡æ¯å·¦å¯¹é½æµ‹è¯•</h3>
        <button onclick="testOrderInfoAlignment()">æµ‹è¯•è®¢å•ä¿¡æ¯å¯¹é½</button>
        <div id="orderInfoResult"></div>
      </div>

      <div class="test-section">
        <h3>ğŸ½ï¸ èœå•è¡¨æ ¼å›ºå®šåˆ—å®½æµ‹è¯•</h3>
        <div class="width-info">
          <strong>åˆ—å®½åˆ†é…:</strong><br />
          â€¢ èœååˆ—ï¼šå å‰©ä½™å®½åº¦ï¼Œè¶…å‡ºè‡ªåŠ¨æ¢è¡Œ<br />
          â€¢ æ•°é‡åˆ—ï¼šå›ºå®š4å­—ç¬¦å®½åº¦ï¼Œå±…ä¸­å¯¹é½<br />
          â€¢ ä»·æ ¼åˆ—ï¼šå›ºå®š8å­—ç¬¦å®½åº¦ï¼Œå³å¯¹é½
        </div>
        <button onclick="testMenuTableLayout()">æµ‹è¯•èœå•è¡¨æ ¼å¸ƒå±€</button>
        <div id="menuTableResult"></div>
      </div>

      <div class="test-section">
        <h3>ğŸ« å®Œæ•´çƒ­æ•å°ç¥¨æµ‹è¯•</h3>
        <button onclick="testCompleteThermalReceipt()">æµ‹è¯•å®Œæ•´çƒ­æ•å°ç¥¨</button>
        <div id="completeReceiptResult"></div>
      </div>

      <div class="test-section">
        <h3>ğŸ“ 80mm vs 58mm å¯¹æ¯”æµ‹è¯•</h3>
        <button onclick="testSizeComparison()">å¯¹æ¯”ä¸¤ç§çº¸å¼ å°ºå¯¸</button>
        <div id="sizeComparisonResult"></div>
      </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="renderer/LodopFuncs.js"></script>
    <script src="src/printer-lodop.js"></script>

    <script>
      let lodopManager = null;

      // åˆå§‹åŒ–
      async function init() {
        try {
          if (typeof LodopPrinterManager !== 'undefined') {
            lodopManager = new LodopPrinterManager();
            const initResult = await lodopManager.init();

            if (initResult.success) {
              console.log('âœ… C-Lodop åˆå§‹åŒ–æˆåŠŸ');
            } else {
              console.log('âŒ C-Lodop åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼');
              // åˆ›å»ºæ¨¡æ‹Ÿçš„æ‰“å°æœºç®¡ç†å™¨ç”¨äºæµ‹è¯•æ’ç‰ˆ
              lodopManager = createMockManager();
            }
          } else {
            console.log('âŒ LodopPrinterManager æœªæ‰¾åˆ°ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼');
            lodopManager = createMockManager();
          }
        } catch (error) {
          console.error('åˆå§‹åŒ–å¤±è´¥:', error);
          lodopManager = createMockManager();
        }
      }

      // åˆ›å»ºæ¨¡æ‹Ÿç®¡ç†å™¨ç”¨äºæµ‹è¯•æ’ç‰ˆ
      function createMockManager() {
        return {
          printers: [{ name: 'æ¨¡æ‹Ÿ80mmæ‰“å°æœº', width: 80 }],
          selectedPrinters: ['æ¨¡æ‹Ÿ80mmæ‰“å°æœº'],
          generateOrderPrintContent: function (order) {
            // ğŸ« çƒ­æ•å°ç¥¨æ¨¡æ‹Ÿæ’ç‰ˆç”Ÿæˆé€»è¾‘
            const paperWidth = 80;
            let totalWidth = 32; // 80mmçƒ­æ•çº¸32å­—ç¬¦

            let content = '';

            // è®¢å•å·åŒºåŸŸï¼šé å·¦å¯¹é½
            content += `Order #: ${order.order_id}\n\n`;

            // è®¢å•ä¿¡æ¯ï¼šé å·¦å¯¹é½ï¼Œæ— é—´éš”å­—ç¬¦
            content += `Order Date: ${this.formatDateTime(
              order.create_time
            )}\n`;
            content += `Pickup Time: ${this.formatDateTime(
              order.delivery_time
            )}\n`;
            content += `Payment: Card\n`;
            content += `Customer: ${order.recipient_name || 'N/A'}\n`;
            content += `Phone: ${order.recipient_phone || 'N/A'}\n`;
            content += `Type: Delivery\n`;

            // åœ°å€å¤„ç†ï¼ˆå¯èƒ½éœ€è¦æ¢è¡Œï¼‰
            if (order.recipient_address) {
              const address = order.recipient_address;
              if (this.displayWidth(`Address: ${address}`) <= totalWidth) {
                content += `Address: ${address}\n`;
              } else {
                content += `Address:\n`;
                const wrappedAddress = this.wrapText(address, totalWidth - 2);
                const addressLines = wrappedAddress.split('\n');
                addressLines.forEach((line) => {
                  if (line.trim()) {
                    content += `  ${line}\n`;
                  }
                });
              }
            }

            content += '\n' + '='.repeat(totalWidth) + '\n';

            // èœå•è¡¨æ ¼ï¼šå›ºå®šåˆ—å®½è®¾è®¡
            const qtyWidth = 4; // æ•°é‡å›ºå®š4å­—ç¬¦
            const priceWidth = 8; // ä»·æ ¼å›ºå®š8å­—ç¬¦
            const nameWidth = totalWidth - qtyWidth - priceWidth; // èœåå å‰©ä½™å®½åº¦

            // è¡¨å¤´
            content += this.padText('Item', nameWidth, 'left');
            content += this.padText('Qty', qtyWidth, 'center');
            content += this.padText('Price', priceWidth, 'right');
            content += '\n';
            content += '-'.repeat(totalWidth) + '\n';

            // èœå•æ˜ç»†ï¼šå›ºå®šåˆ—å®½ï¼Œè‡ªåŠ¨æ¢è¡Œ
            const dishes = order.dishes_array || [];
            dishes.forEach((dish) => {
              const price = parseFloat(dish.price || '0');
              const qty = parseInt(dish.amount || '1');
              const priceStr = `$${price.toFixed(2)}`;
              const qtyStr = qty.toString();

              // èœåå¤„ç†ï¼šå›ºå®šå®½åº¦ï¼Œè¶…å‡ºè‡ªåŠ¨æ¢è¡Œ
              const dishName = dish.dishes_name || '';
              if (this.displayWidth(dishName) <= nameWidth) {
                // èœåä¸è¶…å®½ï¼Œå•è¡Œæ˜¾ç¤º
                content += this.padText(dishName, nameWidth, 'left');
                content += this.padText(qtyStr, qtyWidth, 'center');
                content += this.padText(priceStr, priceWidth, 'right');
                content += '\n';
              } else {
                // èœåè¶…å®½ï¼Œå¤šè¡Œæ˜¾ç¤º
                const wrappedName = this.wrapText(dishName, nameWidth);
                const nameLines = wrappedName.split('\n');

                // ç¬¬ä¸€è¡Œï¼šèœå + æ•°é‡ + ä»·æ ¼
                const firstLine = nameLines[0] || '';
                content += this.padText(firstLine, nameWidth, 'left');
                content += this.padText(qtyStr, qtyWidth, 'center');
                content += this.padText(priceStr, priceWidth, 'right');
                content += '\n';

                // åç»­è¡Œï¼šåªæ˜¾ç¤ºèœåç»­
                for (let i = 1; i < nameLines.length; i++) {
                  if (nameLines[i].trim()) {
                    content += this.padText(nameLines[i], nameWidth, 'left');
                    content += ' '.repeat(qtyWidth + priceWidth);
                    content += '\n';
                  }
                }
              }

              // è§„æ ¼å¤„ç†ï¼šç¼©è¿›æ˜¾ç¤ºï¼Œå›ºå®šå®½åº¦æ¢è¡Œ
              if (dish.remark && dish.remark.trim()) {
                const specIndent = 2;
                const specWidth = nameWidth - specIndent;
                const wrappedSpec = this.wrapText(dish.remark, specWidth);
                const specLines = wrappedSpec.split('\n');

                specLines.forEach((line) => {
                  if (line.trim()) {
                    content += ' '.repeat(specIndent);
                    content += this.padText(line, specWidth, 'left');
                    content += ' '.repeat(qtyWidth + priceWidth);
                    content += '\n';
                  }
                });
              }

              content += '\n'; // æ¯ä¸ªèœå“åç©ºä¸€è¡Œ
            });

            return content;
          },
          formatDateTime: function (dateTimeStr) {
            if (!dateTimeStr) return 'N/A';
            try {
              const date = new Date(dateTimeStr);
              return date.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
              });
            } catch (error) {
              return dateTimeStr;
            }
          },
          displayWidth: function (text) {
            let width = 0;
            for (const char of text) {
              width += char.charCodeAt(0) > 127 ? 2 : 1;
            }
            return width;
          },
          padText: function (text, width, align = 'left') {
            const textWidth = this.displayWidth(text);
            if (textWidth >= width) {
              return this.truncateText(text, width);
            }

            const padding = width - textWidth;
            switch (align) {
              case 'right':
                return ' '.repeat(padding) + text;
              case 'center':
                const leftPad = Math.floor(padding / 2);
                const rightPad = padding - leftPad;
                return ' '.repeat(leftPad) + text + ' '.repeat(rightPad);
              default:
                return text + ' '.repeat(padding);
            }
          },
          truncateText: function (text, maxWidth) {
            let result = '';
            let currentWidth = 0;

            for (const char of text) {
              const charWidth = char.charCodeAt(0) > 127 ? 2 : 1;
              if (currentWidth + charWidth > maxWidth) {
                break;
              }
              result += char;
              currentWidth += charWidth;
            }

            return result;
          },
          wrapText: function (text, width) {
            let result = '';
            let currentLine = '';
            let currentWidth = 0;

            for (const char of text) {
              const charWidth = char.charCodeAt(0) > 127 ? 2 : 1;

              if (currentWidth + charWidth > width && currentLine) {
                result += currentLine + '\n';
                currentLine = '';
                currentWidth = 0;
              }

              currentLine += char;
              currentWidth += charWidth;
            }

            if (currentLine) {
              result += currentLine;
            }

            return result;
          },
        };
      }

      // æµ‹è¯•å­—ç¬¦å®½åº¦ä¼˜åŒ–
      function testWidthOptimization() {
        const result = document.getElementById('widthTestResult');

        const testResults = [];

        // æµ‹è¯•80mmæ‰“å°æœº
        testResults.push('ğŸ”§ 80mmæ‰“å°æœºå­—ç¬¦å®½åº¦æµ‹è¯•:');
        testResults.push(`ä¼˜åŒ–å‰: 42å­—ç¬¦ = "${'='.repeat(42)}"`);
        testResults.push(`ä¼˜åŒ–å: 35å­—ç¬¦ = "${'='.repeat(35)}"`);
        testResults.push('');

        // æµ‹è¯•58mmæ‰“å°æœº
        testResults.push('ğŸ”§ 58mmæ‰“å°æœºå­—ç¬¦å®½åº¦æµ‹è¯•:');
        testResults.push(`ä¼˜åŒ–å‰: 30å­—ç¬¦ = "${'='.repeat(30)}"`);
        testResults.push(`ä¼˜åŒ–å: 25å­—ç¬¦ = "${'='.repeat(25)}"`);

        result.innerHTML = `<div class="preview">${testResults.join(
          '\n'
        )}</div>`;
      }

      // æµ‹è¯•é•¿å†…å®¹æ¢è¡Œ
      function testLongContentWrapping() {
        const result = document.getElementById('wrapTestResult');

        const testData = {
          shortLabel: 'Customer:',
          shortValue: 'John Doe',
          longLabel: 'Address:',
          longValue:
            'This is a very long address that should wrap to multiple lines instead of being truncated',
          veryLongLabel: 'Special Instructions:',
          veryLongValue:
            'Please deliver to the back door and ring the bell three times. Leave the order on the table if no one answers. Thank you!',
        };

        const testResults = [];
        testResults.push('ğŸ”§ é•¿å†…å®¹æ¢è¡Œæµ‹è¯• (35å­—ç¬¦å®½åº¦):');
        testResults.push('='.repeat(35));
        testResults.push('');

        // çŸ­å†…å®¹æµ‹è¯•
        testResults.push('çŸ­å†…å®¹æµ‹è¯•:');
        testResults.push(
          lodopManager.formatAutoAlignedRow(
            testData.shortLabel,
            testData.shortValue,
            35
          )
        );

        // é•¿å†…å®¹æµ‹è¯•
        testResults.push('é•¿å†…å®¹æµ‹è¯•:');
        testResults.push(
          lodopManager.formatAutoAlignedRow(
            testData.longLabel,
            testData.longValue,
            35
          )
        );

        // è¶…é•¿å†…å®¹æµ‹è¯•
        testResults.push('è¶…é•¿å†…å®¹æµ‹è¯•:');
        testResults.push(
          lodopManager.formatAutoAlignedRow(
            testData.veryLongLabel,
            testData.veryLongValue,
            35
          )
        );

        result.innerHTML = `<div class="preview">${testResults.join('')}</div>`;
      }

      // æµ‹è¯•èœå•è¡¨æ ¼ä¼˜åŒ–
      function testMenuTableOptimization() {
        const result = document.getElementById('menuTestResult');

        const testMenuItems = [
          { name: 'Burger', qty: 2, price: 12.99 },
          {
            name: 'Super Deluxe Cheeseburger with Extra Bacon',
            qty: 1,
            price: 18.99,
          },
          { name: 'æ‹›ç‰Œç‚¸é¸¡æ±‰å ¡å¥—é¤', qty: 1, price: 25.5 },
          { name: 'Fries', qty: 3, price: 4.99 },
        ];

        const testResults = [];
        testResults.push('ğŸ”§ èœå•è¡¨æ ¼ä¼˜åŒ–æµ‹è¯• (35å­—ç¬¦å®½åº¦):');
        testResults.push('='.repeat(35));
        testResults.push('');

        // è¡¨å¤´
        testResults.push(lodopManager.formatImprovedMenuHeader(35));
        testResults.push('-'.repeat(35));
        testResults.push('');

        // èœå•é¡¹
        testMenuItems.forEach((item) => {
          testResults.push(
            lodopManager.formatImprovedMenuItemRow(
              item.name,
              item.qty,
              item.price,
              35
            )
          );
        });

        result.innerHTML = `<div class="preview">${testResults.join('')}</div>`;
      }

      // æµ‹è¯•å®Œæ•´è®¢å•
      function testCompleteOrder() {
        const result = document.getElementById('completeTestResult');

        const testOrder = {
          order_id: 'TEST-2024-001',
          create_time: '2024-01-15 14:30:00',
          delivery_time: '2024-01-15 15:00:00',
          paystyle: 1,
          recipient_name: 'John Smith',
          recipient_phone: '(555) 123-4567',
          delivery_type: 1,
          recipient_address:
            '123 Main Street, Apartment 4B, New York, NY 10001',
          dishes_array: [
            {
              dishes_name: 'Classic Cheeseburger',
              amount: 2,
              price: 12.99,
              remark: 'No onions, extra pickles',
            },
            {
              dishes_name:
                'Super Deluxe Bacon Cheeseburger with Extra Everything',
              amount: 1,
              price: 18.99,
              remark: 'Medium rare, extra bacon, no tomatoes, add avocado',
            },
            {
              dishes_name: 'æ‹›ç‰Œç‚¸é¸¡æ±‰å ¡å¥—é¤',
              amount: 1,
              price: 25.5,
              remark: 'å¾®è¾£ï¼Œä¸è¦ç”Ÿèœï¼ŒåŠ èŠå£«',
            },
          ],
          sub_total: 57.48,
          tax_rate: 8.5,
          tax_fee: 4.89,
          delivery_fee: 3.99,
          tip_fee: 8.0,
          total: 74.36,
          order_notes: 'Please call when you arrive. Ring the doorbell twice.',
        };

        const content = lodopManager.generateOrderPrintContent(testOrder);

        result.innerHTML = `
                <div class="info">
                    <strong>âœ… å®Œæ•´è®¢å•æ’ç‰ˆæµ‹è¯•å®Œæˆ</strong><br>
                    æ‰€æœ‰å†…å®¹éƒ½åº”è¯¥åœ¨35å­—ç¬¦å®½åº¦å†…æ­£ç¡®æ˜¾ç¤ºï¼Œé•¿å†…å®¹è‡ªåŠ¨æ¢è¡Œè€Œä¸æˆªæ–­ã€‚
                </div>
                <div class="preview">${content}</div>
            `;
      }

      // æµ‹è¯•çƒ­æ•çº¸å®½åº¦
      function testThermalWidths() {
        const result = document.getElementById('thermalWidthResult');

        const testResults = [];

        // æµ‹è¯•80mmçƒ­æ•çº¸
        testResults.push('ğŸ”§ 80mmçƒ­æ•çº¸å­—ç¬¦å®½åº¦æµ‹è¯•:');
        testResults.push(`80mmçƒ­æ•çº¸: 32å­—ç¬¦å®½åº¦ï¼Œå­—ä½“12pt`);
        testResults.push('');

        // æµ‹è¯•58mmçƒ­æ•çº¸
        testResults.push('ğŸ”§ 58mmçƒ­æ•çº¸å­—ç¬¦å®½åº¦æµ‹è¯•:');
        testResults.push(`58mmçƒ­æ•çº¸: 24å­—ç¬¦å®½åº¦ï¼Œå­—ä½“11pt`);
        testResults.push('');

        result.innerHTML = `<div class="preview">${testResults.join(
          '\n'
        )}</div>`;
      }

      // æµ‹è¯•è®¢å•ä¿¡æ¯å·¦å¯¹é½
      function testOrderInfoAlignment() {
        const result = document.getElementById('orderInfoResult');

        const testResults = [];
        testResults.push('ğŸ« è®¢å•ä¿¡æ¯å·¦å¯¹é½æµ‹è¯• (32å­—ç¬¦å®½åº¦):');
        testResults.push('='.repeat(32) + '\n');

        // æ¨¡æ‹Ÿè®¢å•ä¿¡æ¯å·¦å¯¹é½æ˜¾ç¤º
        testResults.push('Order #: TEST-2024-001\n');
        testResults.push('Order Date: 01/15/2024, 2:30 PM');
        testResults.push('Pickup Time: 01/15/2024, 3:00 PM');
        testResults.push('Payment: Card');
        testResults.push('Customer: John Smith');
        testResults.push('Phone: (555) 123-4567');
        testResults.push('Type: Delivery');
        testResults.push('Address:');
        testResults.push('  123 Main Street, Apartment');
        testResults.push('  4B, New York, NY 10001');

        result.innerHTML = `<div class="preview">${testResults.join(
          '\n'
        )}</div>`;
      }

      // æµ‹è¯•èœå•è¡¨æ ¼å¸ƒå±€
      function testMenuTableLayout() {
        const result = document.getElementById('menuTableResult');

        const testResults = [];
        testResults.push('ğŸ« èœå•è¡¨æ ¼å›ºå®šåˆ—å®½æµ‹è¯• (32å­—ç¬¦):');
        testResults.push('='.repeat(32));
        testResults.push('');

        // æ‰‹åŠ¨æ„å»ºè¡¨æ ¼ç¤ºä¾‹
        const totalWidth = 32;
        const qtyWidth = 4;
        const priceWidth = 8;
        const nameWidth = totalWidth - qtyWidth - priceWidth; // 20å­—ç¬¦

        // è¡¨å¤´
        testResults.push(
          padText('Item', nameWidth, 'left') +
            padText('Qty', qtyWidth, 'center') +
            padText('Price', priceWidth, 'right')
        );
        testResults.push('-'.repeat(32));

        // æµ‹è¯•èœå“
        const testItems = [
          { name: 'Burger', qty: 2, price: 12.99 },
          {
            name: 'Super Deluxe Cheeseburger with Extra Bacon and Cheese',
            qty: 1,
            price: 18.99,
          },
          { name: 'æ‹›ç‰Œç‚¸é¸¡æ±‰å ¡å¥—é¤', qty: 1, price: 25.5 },
        ];

        testItems.forEach((item) => {
          const priceStr = `$${item.price.toFixed(2)}`;
          const qtyStr = item.qty.toString();

          if (displayWidth(item.name) <= nameWidth) {
            // å•è¡Œæ˜¾ç¤º
            testResults.push(
              padText(item.name, nameWidth, 'left') +
                padText(qtyStr, qtyWidth, 'center') +
                padText(priceStr, priceWidth, 'right')
            );
          } else {
            // å¤šè¡Œæ˜¾ç¤º
            const wrappedName = wrapText(item.name, nameWidth);
            const nameLines = wrappedName.split('\n');

            // ç¬¬ä¸€è¡Œ
            testResults.push(
              padText(nameLines[0] || '', nameWidth, 'left') +
                padText(qtyStr, qtyWidth, 'center') +
                padText(priceStr, priceWidth, 'right')
            );

            // åç»­è¡Œ
            for (let i = 1; i < nameLines.length; i++) {
              if (nameLines[i].trim()) {
                testResults.push(
                  padText(nameLines[i], nameWidth, 'left') +
                    ' '.repeat(qtyWidth + priceWidth)
                );
              }
            }
          }
          testResults.push(''); // ç©ºè¡Œ
        });

        result.innerHTML = `<div class="preview">${testResults.join(
          '\n'
        )}</div>`;
      }

      // è¾…åŠ©å‡½æ•°
      function displayWidth(text) {
        let width = 0;
        for (const char of text) {
          width += char.charCodeAt(0) > 127 ? 2 : 1;
        }
        return width;
      }

      function padText(text, width, align = 'left') {
        const textWidth = displayWidth(text);
        if (textWidth >= width) {
          return truncateText(text, width);
        }

        const padding = width - textWidth;
        switch (align) {
          case 'right':
            return ' '.repeat(padding) + text;
          case 'center':
            const leftPad = Math.floor(padding / 2);
            const rightPad = padding - leftPad;
            return ' '.repeat(leftPad) + text + ' '.repeat(rightPad);
          default:
            return text + ' '.repeat(padding);
        }
      }

      function truncateText(text, maxWidth) {
        let result = '';
        let currentWidth = 0;

        for (const char of text) {
          const charWidth = char.charCodeAt(0) > 127 ? 2 : 1;
          if (currentWidth + charWidth > maxWidth) {
            break;
          }
          result += char;
          currentWidth += charWidth;
        }

        return result;
      }

      function wrapText(text, width) {
        let result = '';
        let currentLine = '';
        let currentWidth = 0;

        for (const char of text) {
          const charWidth = char.charCodeAt(0) > 127 ? 2 : 1;

          if (currentWidth + charWidth > width && currentLine) {
            result += currentLine + '\n';
            currentLine = '';
            currentWidth = 0;
          }

          currentLine += char;
          currentWidth += charWidth;
        }

        if (currentLine) {
          result += currentLine;
        }

        return result;
      }

      // æµ‹è¯•å®Œæ•´çƒ­æ•å°ç¥¨
      function testCompleteThermalReceipt() {
        const result = document.getElementById('completeReceiptResult');

        const testOrder = {
          order_id: 'TEST-2024-001',
          create_time: '2024-01-15 14:30:00',
          delivery_time: '2024-01-15 15:00:00',
          paystyle: 1,
          recipient_name: 'John Smith',
          recipient_phone: '(555) 123-4567',
          delivery_type: 1,
          recipient_address:
            '123 Main Street, Apartment 4B, New York, NY 10001',
          dishes_array: [
            {
              dishes_name: 'Classic Cheeseburger',
              amount: 2,
              price: 12.99,
              remark: 'No onions, extra pickles',
            },
            {
              dishes_name:
                'Super Deluxe Bacon Cheeseburger with Extra Everything',
              amount: 1,
              price: 18.99,
              remark: 'Medium rare, extra bacon, no tomatoes, add avocado',
            },
            {
              dishes_name: 'æ‹›ç‰Œç‚¸é¸¡æ±‰å ¡å¥—é¤',
              amount: 1,
              price: 25.5,
              remark: 'å¾®è¾£ï¼Œä¸è¦ç”Ÿèœï¼ŒåŠ èŠå£«',
            },
          ],
          sub_total: 57.48,
          tax_rate: 8.5,
          tax_fee: 4.89,
          delivery_fee: 3.99,
          tip_fee: 8.0,
          total: 74.36,
          order_notes: 'Please call when you arrive. Ring the doorbell twice.',
        };

        const content = lodopManager.generateOrderPrintContent(testOrder);

        result.innerHTML = `
                <div class="info">
                    <strong>âœ… å®Œæ•´çƒ­æ•å°ç¥¨æµ‹è¯•å®Œæˆ</strong><br>
                    ä¸“é—¨é’ˆå¯¹80mm/58mmçƒ­æ•å°ç¥¨æœºä¼˜åŒ–çš„æ’ç‰ˆæ ¼å¼ã€‚
                </div>
                <div class="preview">${content}</div>
            `;
      }

      // æµ‹è¯•80mm vs 58mmå¯¹æ¯”
      function testSizeComparison() {
        const result = document.getElementById('sizeComparisonResult');

        const testResults = [];

        // 80mmæµ‹è¯•
        testResults.push('ğŸ« 80mmçƒ­æ•çº¸æµ‹è¯• (32å­—ç¬¦å®½åº¦):');
        testResults.push('='.repeat(32));
        testResults.push('Order #: TEST-001');
        testResults.push('Customer: John Smith');
        testResults.push('Phone: (555) 123-4567');
        testResults.push('');
        testResults.push('Item                Qty Price   ');
        testResults.push('--------------------------------');
        testResults.push('Classic Cheeseburger 2   $12.99 ');
        testResults.push('Super Deluxe Bacon   1   $18.99 ');
        testResults.push('Cheeseburger with           ');
        testResults.push('Extra Everything            ');
        testResults.push('');
        testResults.push('Subtotal              $57.48');
        testResults.push('Tax (8.5%)            $4.89');
        testResults.push('TOTAL                 $74.36');
        testResults.push('');

        // 58mmæµ‹è¯•
        testResults.push('ğŸ« 58mmçƒ­æ•çº¸æµ‹è¯• (24å­—ç¬¦å®½åº¦):');
        testResults.push('='.repeat(24));
        testResults.push('Order #: TEST-001');
        testResults.push('Customer: John Smith');
        testResults.push('Phone: (555) 123-4567');
        testResults.push('');
        testResults.push('Item            Qty Price');
        testResults.push('------------------------');
        testResults.push('Classic          2  $12.99');
        testResults.push('Cheeseburger');
        testResults.push('Super Deluxe     1  $18.99');
        testResults.push('Bacon');
        testResults.push('Cheeseburger');
        testResults.push('with Extra');
        testResults.push('Everything');
        testResults.push('');
        testResults.push('Subtotal      $57.48');
        testResults.push('Tax (8.5%)     $4.89');
        testResults.push('TOTAL         $74.36');

        result.innerHTML = `<div class="preview">${testResults.join(
          '\n'
        )}</div>`;
      }

      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      window.addEventListener('load', init);
    </script>
  </body>
</html>
